/*Entita'*/

/*Creazione tabella Cliente Carta Passione Cinema*/
CREATE TABLE CliCPC (
    CodiceFiscale CHAR(16) PRIMARY KEY,
    Nome VARCHAR(20) NOT NULL,
    Cognome VARCHAR(20) NOT NULL,
    DataNascita DATE,
    Telefono VARCHAR(10) UNIQUE,
    Sesso VARCHAR(10),
	CHECK (Sesso='Maschio' OR Sesso='Femmina' OR Sesso='Altro')
    Nazionalità VARCHAR(20),
    NumeroCarta CHAR(16) NOT NULL UNIQUE,
    Città VARCHAR(30),
    CAP VARCHAR(5),
    Via VARCHAR(20),
    NumeroCivico CHAR(4)
);

/*Creazione tabella Cliente Online*/					 
CREATE TABLE CliOnline (
    CodiceFiscale CHAR(16) PRIMARY KEY,
    Nome VARCHAR(20) NOT NULL,
    Cognome VARCHAR(20) NOT NULL,
    DataNascita DATE,
    Telefono CHAR(10),
    Email VARCHAR(30) NOT NULL UNIQUE,
    Password VARCHAR(20) NOT NULL
);

/*Creazione tabella Acquisto Bar*/
CREATE TABLE AcqBar (
    ID INTEGER PRIMARY KEY AUTO_INCREMENT,
    Data DATE,
    Ora TIME,
    CostoTotale DECIMAL(6,2) NOT NULL,
    Cliente CHAR(16) REFERENCES CliCPC(CodiceFiscale) ON UPDATE CASCADE
);


/*Creazione tabella Prodotto*/
CREATE TABLE Prodotto (
    ID INTEGER PRIMARY KEY AUTO_INCREMENT,
    Nome VARCHAR(20) NOT NULL UNIQUE,
    Prezzo DECIMAL(6,2)
);


/*Creazione tabella Genere*/
CREATE TABLE Genere (
    Genere VARCHAR(20) PRIMARY KEY
);



/*Creazione tabella Film*/
CREATE TABLE Film (
    Codice INTEGER PRIMARY KEY AUTOINCREMENT,
    Titolo VARCHAR(50) NOT NULL,
    Anno YEAR,
    Durata INTEGER,
    Valutazione DECIMAL(1,1)
);

/*Creazione tabella Persona*/
CREATE TABLE Persona (
    Codice INTEGER PRIMARY KEY AUTOINCREMENT,
    Nome VARCHAR(20) NOT NULL,
    Cognome VARCHAR(20) NOT NULL,
    DataNascita DATE
);

/*Creazione tabella Sala*/
CREATE TABLE Sala (
    Numero INTEGER PRIMARY KEY,
    Metratura DECIMAL(5,2)
);

/*Creazione tabella Fila*/
CREATE TABLE Fila (
    Lettera CHAR(1) PRIMARY KEY,
    Sala INTEGER REFERENCES Sala(Numero) ON UPDATE CASCADE ON DELETE CASCADE
);


/*Creazione tabella Posto*/
CREATE TABLE Posto (
    Numero INTEGER PRIMARY KEY,
    Fila CHAR(1) REFERENCES Fila(Lettera) ON UPDATE CASCADE ON DELETE CASCADE,
    Sala INTEGER REFERENCES Fila(Sala) ON UPDATE CASCADE ON DELETE CASCADE
);

/*Creazione tabella Tariffario*/
CREATE TABLE Tariffario (
    Codice INTEGER PRIMARY KEY AUTO_INCREMENT,
    Descrizione VARCHAR(20) NOT NULL,
    Prezzo DECIMAL NOT NULL
);

/*Creazione tabella Orario*/
CREATE TABLE Orario (
    Numero INTEGER PRIMARY KEY,
    OraInizio TIME NOT NULL,
    OraFine TIME NOT NULL
);










/*Creazione tabella Acquisto Biglietto Online*/
CREATE TABLE AcqOnline (
    ID INTEGER PRIMARY KEY AUTOINCREMENT,
    CostoTotale DECIMAL NOT NULL,
    Film VARCHAR(50) NOT NULL,
    DataAcq DATE NOT NULL,
    DataProiez DATE NOT NULL,
    Orario TIME REFERENCES Orario(Numero),
    Cliente CHAR(16) REFERENCES CliOnline(CodiceFiscale) 
);

/*Creazione tabella Acquisto Biglietto Fisico*/
CREATE TABLE AcqFisico (
    ID INTEGER PRIMARY KEY AUTOINCREMENT,
    CostoTotale DECIMAL(6,2) NOT NULL,
    Film VARCHAR(50) NOT NULL,
    DataProiez DATE NOT NULL,
    Orario INTEGER REFERENCES Orario(Numero),
    Cliente CHAR(16) REFERENCES CliCPC(CodiceFiscale),
    Pagamento VARCHAR(20) NOT NULL
);



/*Relazioni*/


/*Creazione tabella Appartenenza*/
CREATE TABLE Appart (
    Film INTEGER REFERENCES Film(Codice) ON UPDATE CASCADE ON DELETE CASCADE,
    Genere INTEGER REFERENCES Genere(Genere) ON UPDATE CASCADE ON DELETE CASCADE
);

/*Creazione tabella Partecipazione*/
CREATE TABLE Partecip (
    Film INTEGER REFERENCES Film(Codice) ON UPDATE CASCADE ON DELETE CASCADE,
    Persona INTEGER REFERENCES Persona(Codice) ON UPDATE CASCADE ON DELETE CASCADE,
    Ruolo VARCHAR(10) NOT NULL
);

/*Creazione tabella Programmazione*/
CREATE TABLE Program (
    Film INTEGER REFERENCES Film(Codice) ON UPDATE CASCADE ON DELETE CASCADE,
    Sala INTEGER REFERENCES Sala(Numero) ON UPDATE CASCADE ON DELETE CASCADE,
    DataInizio DATE,
    DataFine DATE
);

/*Creazione tabella Scelta Fisica*/
CREATE TABLE SceltaFisica (
    AcqFisico INTEGER REFERENCES AcqFisico(ID) ON UPDATE CASCADE ON DELETE CASCADE,
    Sala INTEGER REFERENCES Posto(Sala) ON UPDATE CASCADE ON DELETE NO ACTION,
    Fila CHAR(1) REFERENCES Posto(Fila) ON UPDATE CASCADE ON DELETE NO ACTION,
    Posto INTEGER REFERENCES Posto(Numero) ON UPDATE CASCADE ON DELETE NO ACTION,
    Tariffa INTEGER REFERENCES Tariffario(Codice) ON UPDATE CASCADE ON DELETE NO ACTION
);



/*Creazione tabella Scelta Online*/
CREATE TABLE SceltaOnline (
    AcqOnline INTEGER REFERENCES AcqOnline(ID) ON UPDATE CASCADE ON DELETE CASCADE,
    Sala INTEGER REFERENCES Posto(Sala) ON UPDATE CASCADE ON DELETE NO ACTION,
    Fila CHAR(1) REFERENCES Posto(Fila) ON UPDATE CASCADE ON DELETE NO ACTION,
    Posto INTEGER REFERENCES Posto(Numero) ON UPDATE CASCADE ON DELETE NO ACTION,
    Tariffa INTEGER REFERENCES Tariffario(Codice) ON UPDATE CASCADE ON DELETE NO ACTION 
);

/*Creazione tabella Contenere*/
CREATE TABLE Contenere (
    AcqBar INTEGER REFERENCES AcqBar(ID) ON UPDATE CASCADE ON DELETE CASCADE,
    Prodotto INTEGER REFERENCES Prodotto(ID) ON UPDATE CASCADE ON DELETE NO ACTION,
    Quantita INTEGER NOT NULL
);

/*Creazione tabella Composto*/
CREATE TABLE Compos (
    Composto INTEGER REFERENCES Prodotto(ID) ON UPDATE CASCADE ON DELETE CASCADE,
    Componente INTEGER REFERENCES Prodotto(ID) ON UPDATE CASCADE ON DELETE NO ACTION,
    Quantita INTEGER NOT NULL
);










